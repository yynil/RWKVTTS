from sparktts.models.audio_tokenizer import BiCodecTokenizer

model_dir = '/home/yueyulin/models/Spark-TTS-0.5B/'
device = 'cuda:3'
audio_tokenizer = BiCodecTokenizer(model_dir, device)

data = {"language": "zh", "text": "我们可以尝试制作一个梦想相册，将我们的愿望啊以图片的形式贴在里面，每天都来翻看，让自己的潜意识不断的受到刺激。", "speaker": "ZH_B00000_S09992", "global_tokens": [1963, 1778, 1200, 4068, 482, 1262, 3312, 408, 3850, 3864, 595, 3160, 741, 3368, 3251, 1275, 1277, 3329, 2206, 4031, 10, 2260, 1935, 2881, 1067, 2856, 3573, 333, 2673, 343, 3908, 687], "semantic_tokens": [284, 1990, 458, 2506, 6642, 2864, 3560, 8115, 2593, 4275, 6159, 2299, 4935, 6643, 1050, 2631, 1168, 4543, 5485, 3474, 2134, 6793, 8110, 4705, 2364, 3266, 3376, 910, 900, 80, 612, 4470, 149, 3092, 2600, 7405, 5825, 1556, 7770, 5317, 6343, 7548, 3059, 1566, 6050, 850, 8012, 5778, 811, 7406, 4403, 3114, 8019, 2688, 1956, 6747, 4211, 3052, 4828, 3711, 4169, 4828, 2826, 4057, 5753, 1530, 3265, 1488, 5996, 5467, 7441, 1550, 5237, 2154, 4567, 7958, 354, 4304, 4184, 644, 7975, 7163, 6053, 4933, 768, 6634, 3853, 3441, 6790, 6207, 73, 1231, 4827, 7978, 3461, 6538, 4878, 8043, 2699, 6154, 6391, 1174, 2820, 5571, 3183, 3541, 5883, 6707, 7261, 7493, 7668, 4503, 7386, 7037, 7005, 1365, 7223, 6160, 1574, 2298, 6309, 7819, 4571, 6638, 6980, 2108, 1101, 1115, 2544, 5575, 2946, 4407, 1743, 4841, 7203, 7926, 3503, 5060, 5691, 4999, 6702, 6853, 2616, 2981, 592, 6584, 4359, 7477, 5332, 974, 7285, 7902, 2192, 1455, 3511, 3354, 1810, 4626, 3927, 127, 3387, 5001, 3281, 3162, 2169, 398, 3562, 4205, 2296, 5564, 5217, 777, 5626, 6015, 3854, 734, 5645, 7089, 7742, 2629, 1593, 6731, 2829, 5949, 5746, 5023, 2238, 6874, 4358, 949, 7312, 5086, 6677, 4321, 2664, 500, 7315, 6268, 3225, 3074, 7435, 2293, 2079, 2761, 1729, 7775, 3953, 5185, 4215, 6204, 5123, 4074, 7004, 4543, 5607, 7956, 5348, 1576, 1716, 3320, 6489, 347, 3066, 956, 1459, 5500, 4796, 246, 6552, 7313, 3409, 2296, 659, 2309, 5756, 4154, 6536, 110, 4234, 1300, 7362, 2510, 3120, 1271, 6709, 2165, 7131, 5453, 59, 2451, 6895, 7515, 5644, 8149, 3162, 309, 1696, 5819, 3813, 3167, 7579, 8047, 7891, 2687, 638, 169, 8016, 5206, 4328, 3098, 959, 4927, 4579, 8093, 6846, 1852, 7696, 5309, 1532, 7001, 306, 184, 6422, 6773, 2058, 4401, 2785, 1503, 6979, 7411, 3973, 7659, 94, 6069, 4247, 1678, 4400, 2921, 5828, 1047, 8063, 1949, 5023, 803, 6212, 7965, 7678, 6887, 3142, 6561, 2631, 7066, 2364, 3851, 7409, 1063, 3114, 56, 7011, 5771, 743, 3666, 5718, 6012, 3011, 7538, 5317, 4615, 2752, 3168, 2800, 5220, 2481, 4483, 4044, 2693, 6505, 219, 4475, 5642, 4686, 3583, 1152, 8125, 52, 836, 4623, 4845, 6302, 3285, 7643, 899, 5293, 6797, 7438, 7691, 4207, 8004, 4454, 6932, 7196, 2347, 7664, 7322, 821, 2570, 3527, 7377, 3377, 7162, 2, 4795, 2755, 4946, 2973, 7727]}
import torch
global_tokens = [3843, 1025, 2036, 3286, 533, 3146, 3302, 1287, 2078, 1420, 2014, 3191, 115, 3584, 3252, 2460, 4082, 3071, 2505, 3099, 3066, 1451, 1929, 3650, 2166, 1546, 3271, 381, 3505, 1642, 89, 3707]
semantic_tokens = [4305, 3593, 7396, 4185, 7808, 4399, 948, 4139, 1732, 6304, 7620, 6475, 743, 1307, 2423, 7949, 4269, 7719, 5552, 986, 5938, 3223, 1172, 1429, 4761, 8015, 8122, 3454, 5545, 7785, 3902, 1278, 2543, 5834, 3552, 2406, 7133, 5495, 1019, 3125, 6141, 2652, 6087, 7748, 4590, 2999, 574, 1172, 2420, 1945, 5701, 4202, 1076, 601, 4836, 6665, 3518, 4252, 7028, 4185, 4131, 7828, 4900, 8078, 1781, 6688, 2396, 5802, 2116, 2866, 5308, 6863, 2153, 861, 1817, 2874, 2827, 4976, 5969, 7652, 6595, 2891, 8006, 6094, 5046, 2343, 4723, 572, 7073, 4245, 5856, 7534, 5736, 5275, 3027, 4395, 5343, 6697, 5408, 4436, 4510, 2177, 1710, 7972, 7444, 222, 5904, 4582, 5904, 2010, 2185, 2869, 3230, 5338, 2838, 4124, 1297, 8157, 1561, 2236, 1551, 3507, 7828, 3436, 3323, 413, 4942, 3710, 8143, 2172, 2771, 5883, 3704, 7442, 2869, 8045, 420, 1467, 2512, 4516, 270, 7652, 5242, 2407, 7014, 4393, 4041, 3144, 1603, 6184, 2751, 4102, 454, 2465, 4690, 5367, 6200, 3093, 148, 1192, 8036, 768, 3516, 1623, 2804, 7654, 722, 3240, 4516, 7460, 3679, 1202, 7150, 3192, 6447, 4588, 2411, 6524, 2185, 4054, 7158, 462, 7192, 519, 7211, 6105, 673, 73, 7503, 6262, 7699, 1023, 4710, 7881, 6758, 5187, 6309, 3272, 6101, 3704, 4821, 2263, 2676, 2435, 3771, 4020, 4111, 4372, 5888, 127, 5716, 30, 4657, 229, 7404, 838, 5458, 2326, 6808, 6879, 7720, 8036, 5301, 5269, 4935, 7094, 5193, 4020, 6611, 6173, 2465, 3710, 4999, 4821, 2881, 7154, 1044, 6501, 6668, 7958, 7333, 3213, 4913, 7909, 5198, 6107, 7461, 1429, 2859, 4392, 6537, 5955, 2456, 4886, 2441, 2827, 2787, 2451, 1327, 6029, 7329, 7628, 5811, 1689, 6188, 7211, 1052, 6878, 3431, 1849, 4425, 5583, 1992, 7969, 7095, 3896, 3896, 7296, 6107, 6290, 7109, 31, 8163, 6238, 7723, 1443, 1142, 6447, 1656, 2185, 3904, 519, 2787, 2787, 861, 445, 7125, 270, 6026, 7192, 2186, 6883, 4692, 1085, 593, 2153, 2007, 8057, 1840]
# global_tokens = torch.tensor(data["global_tokens"]).unsqueeze(0).to(device)
# semantic_tokens = torch.tensor(data["semantic_tokens"]).unsqueeze(0).to(device)
global_tokens = torch.tensor(global_tokens).unsqueeze(0).to(device)
semantic_tokens = torch.tensor(semantic_tokens).unsqueeze(0).to(device)
wav_reconstructed = audio_tokenizer.detokenize(global_tokens, semantic_tokens)

import soundfile as sf
sf.write("from_spark_audio_tokens.wav", wav_reconstructed, audio_tokenizer.config['sample_rate'])