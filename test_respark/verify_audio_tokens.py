from sparktts.models.audio_tokenizer import BiCodecTokenizer

model_dir = '/home/yueyulin/models/Spark-TTS-0.5B/'
device = 'cpu'
audio_tokenizer = BiCodecTokenizer(model_dir, device)

data = {"language": "zh", "text": "我们可以尝试制作一个梦想相册，将我们的愿望啊以图片的形式贴在里面，每天都来翻看，让自己的潜意识不断的受到刺激。", "speaker": "ZH_B00000_S09992", "global_tokens": [1963, 1778, 1200, 4068, 482, 1262, 3312, 408, 3850, 3864, 595, 3160, 741, 3368, 3251, 1275, 1277, 3329, 2206, 4031, 10, 2260, 1935, 2881, 1067, 2856, 3573, 333, 2673, 343, 3908, 687], "semantic_tokens": [284, 1990, 458, 2506, 6642, 2864, 3560, 8115, 2593, 4275, 6159, 2299, 4935, 6643, 1050, 2631, 1168, 4543, 5485, 3474, 2134, 6793, 8110, 4705, 2364, 3266, 3376, 910, 900, 80, 612, 4470, 149, 3092, 2600, 7405, 5825, 1556, 7770, 5317, 6343, 7548, 3059, 1566, 6050, 850, 8012, 5778, 811, 7406, 4403, 3114, 8019, 2688, 1956, 6747, 4211, 3052, 4828, 3711, 4169, 4828, 2826, 4057, 5753, 1530, 3265, 1488, 5996, 5467, 7441, 1550, 5237, 2154, 4567, 7958, 354, 4304, 4184, 644, 7975, 7163, 6053, 4933, 768, 6634, 3853, 3441, 6790, 6207, 73, 1231, 4827, 7978, 3461, 6538, 4878, 8043, 2699, 6154, 6391, 1174, 2820, 5571, 3183, 3541, 5883, 6707, 7261, 7493, 7668, 4503, 7386, 7037, 7005, 1365, 7223, 6160, 1574, 2298, 6309, 7819, 4571, 6638, 6980, 2108, 1101, 1115, 2544, 5575, 2946, 4407, 1743, 4841, 7203, 7926, 3503, 5060, 5691, 4999, 6702, 6853, 2616, 2981, 592, 6584, 4359, 7477, 5332, 974, 7285, 7902, 2192, 1455, 3511, 3354, 1810, 4626, 3927, 127, 3387, 5001, 3281, 3162, 2169, 398, 3562, 4205, 2296, 5564, 5217, 777, 5626, 6015, 3854, 734, 5645, 7089, 7742, 2629, 1593, 6731, 2829, 5949, 5746, 5023, 2238, 6874, 4358, 949, 7312, 5086, 6677, 4321, 2664, 500, 7315, 6268, 3225, 3074, 7435, 2293, 2079, 2761, 1729, 7775, 3953, 5185, 4215, 6204, 5123, 4074, 7004, 4543, 5607, 7956, 5348, 1576, 1716, 3320, 6489, 347, 3066, 956, 1459, 5500, 4796, 246, 6552, 7313, 3409, 2296, 659, 2309, 5756, 4154, 6536, 110, 4234, 1300, 7362, 2510, 3120, 1271, 6709, 2165, 7131, 5453, 59, 2451, 6895, 7515, 5644, 8149, 3162, 309, 1696, 5819, 3813, 3167, 7579, 8047, 7891, 2687, 638, 169, 8016, 5206, 4328, 3098, 959, 4927, 4579, 8093, 6846, 1852, 7696, 5309, 1532, 7001, 306, 184, 6422, 6773, 2058, 4401, 2785, 1503, 6979, 7411, 3973, 7659, 94, 6069, 4247, 1678, 4400, 2921, 5828, 1047, 8063, 1949, 5023, 803, 6212, 7965, 7678, 6887, 3142, 6561, 2631, 7066, 2364, 3851, 7409, 1063, 3114, 56, 7011, 5771, 743, 3666, 5718, 6012, 3011, 7538, 5317, 4615, 2752, 3168, 2800, 5220, 2481, 4483, 4044, 2693, 6505, 219, 4475, 5642, 4686, 3583, 1152, 8125, 52, 836, 4623, 4845, 6302, 3285, 7643, 899, 5293, 6797, 7438, 7691, 4207, 8004, 4454, 6932, 7196, 2347, 7664, 7322, 821, 2570, 3527, 7377, 3377, 7162, 2, 4795, 2755, 4946, 2973, 7727]}
import torch
global_tokens = [1659, 3636, 3072, 2860, 110, 260, 355, 472, 1918, 3960, 146, 3313, 815, 2365, 2414, 386, 3636, 1345, 3662, 3897, 1089, 3852, 2687, 1869, 3351, 1836, 3868, 207, 307, 559, 3436, 1107]
semantic_tokens = [2696, 3286, 5818, 3539, 4190, 6242, 1128, 1301, 3964, 2761, 7248, 3238, 3310, 7879, 3469, 2304, 4402, 2791, 8110, 6046, 7736, 4702, 7835, 3339, 2362, 5674, 5462, 4253, 2095, 6078, 1611, 2601, 2856, 2042, 5579, 422, 1364, 224, 7240, 2403, 2381, 5136, 5486, 1483, 2435, 2481, 1483, 130, 2979, 1513, 7726, 6505, 3837, 5473, 6388, 7540, 4684, 1318, 840, 3806, 5485, 3633, 7950, 3441, 5843, 7440, 4827, 3583, 6948, 8069, 1836, 381, 2765, 4115, 3594, 344, 3351, 3004, 7504, 6766, 5987, 7279, 3401, 2515, 4557, 277, 1040, 3226, 1683, 2916, 264, 2247, 2068, 3494, 3816, 3903, 5562, 766, 5654, 1848, 7032, 6334, 1972, 776, 7691, 7283, 2774, 378, 1614, 55, 208, 1606, 1395, 2036, 4353, 7100, 5718, 2978, 4517, 1902, 1382, 6819, 7295, 3674, 5462, 8139, 3629, 206, 3207, 8106, 1803, 3511, 210, 5953, 5040, 2992, 3043, 3417, 1819, 39, 5180, 4437, 8132, 2928, 6197, 5959, 1205, 4333, 5520, 5065, 3253, 7290, 4212, 5150, 2285, 6691, 7909, 1867, 5202, 1001, 3147, 1393, 467, 488, 100, 6508, 5611, 179, 7205, 1771, 5871, 7888, 906, 3391, 1625, 5454, 4853, 8119, 7879, 4868, 6018, 4104, 3703, 5776, 3506, 322, 8056, 1037, 2375, 6549, 6660, 792, 1352, 3874, 5657, 3312, 2199, 5146, 1262, 6525, 7015, 6411, 5089, 2808, 2771, 7136, 989, 5124, 4554, 2803, 5934, 46, 1096, 6293, 6421, 1532, 2789, 1449, 6581, 2969, 7198, 4712, 3000, 7174, 1170, 3509, 5218, 3233, 7675, 2896, 3554, 5808, 5636, 3339, 2989, 5678, 5373, 5086, 6173, 7536, 2428, 6109, 6930, 3002, 601, 3961, 2100, 2093, 3519, 3758, 5331, 7871, 2665, 2156, 7833, 2156, 5699, 3978, 3881, 1496, 1043, 5201, 6690, 4803, 7307, 7426, 10, 8026, 4231, 784, 5559, 1723, 8135, 3254, 4601, 5711, 1754, 3940, 612, 5654, 2027, 5945, 7125, 5531, 1831, 3114, 4912, 847, 1404, 2227, 680, 1310, 590, 2944, 3798, 6011, 6323, 3161, 2697, 7658, 4322, 1533, 5660, 5292, 6332, 2938, 7893, 3303, 6699, 6029, 5210, 6178, 4706, 6439, 7945, 5715, 4394, 7623, 3478, 4783, 5403, 1037, 4649, 934, 4912, 741, 7156, 6251, 3729, 8058, 3897, 5250, 592, 2194, 6480, 6448, 4463, 3457, 4090, 3966, 7801, 4750, 4021, 3099, 4442, 4261, 4962, 6191, 2586, 1060, 7473, 5366, 5142, 6508, 2626, 2590, 2365, 7632, 2885, 4808, 904, 5094, 3653, 1518, 6056, 7330, 8017, 2575, 1875, 2519, 1943, 3486, 1548, 5719, 3698, 1477, 914, 2888, 6962, 3633, 638, 6215, 6682, 1461, 8124, 4013, 7530, 7667, 2399, 4563, 1440, 2200, 5386, 3828, 1485, 20, 7851, 3110, 6516, 6676, 6131, 4948, 2072, 4575, 2364, 5446, 2616, 2736, 3932, 4767, 7949, 8130, 650, 6698, 7823, 6539, 4680, 2027, 8052, 6089, 1831, 5938, 772, 2450, 3116, 2791, 5905, 7954, 1658, 4910, 1716, 5761, 1413, 7210, 582, 3883, 1705, 1917, 5373, 4457, 6138, 7428, 8100, 506, 6624, 4080, 406, 3690, 1589, 7440, 6168, 5667, 2746, 1435, 4064, 5220, 2035, 1114, 3531, 2655, 7143, 2244, 2856, 4927, 5383, 1394, 4184, 3761, 2659, 1653, 1156, 1811, 2697, 6613, 6426, 3183, 6397, 7348, 7639, 266, 7901, 3541, 3723, 3367, 8134, 4402, 613, 6817, 3703, 1416, 3041, 5929, 4027, 5215, 2896, 5624, 1949, 5764, 6072, 5410, 1094, 1690, 3208, 5579, 4442, 4080, 6898, 3427, 7214, 6683, 4021, 291, 5485, 8081, 6904, 4352, 7171, 4141, 4140, 1375, 5463, 7787, 2178, 2012, 3585, 4353, 7678, 122, 6151, 6296, 5322, 2757, 3226, 3806, 4369, 8022, 1738, 1419, 1086, 6999, 150, 4361, 7921, 4199, 3837, 138, 698, 3081, 4905, 7391, 2030, 2670, 32, 3919, 168, 7923, 6845, 209, 7431, 922, 2272, 2948, 4546, 945, 4019, 4650, 7986, 6509, 6134, 87, 8135, 1410, 5921, 5477, 2642, 1613, 728, 7726, 4951, 1592, 7104, 6880, 1723, 7726, 1637, 1059, 7574, 4946, 5359, 2076, 2059, 5708, 422, 528, 2117, 5321, 6538, 4578, 5169, 4879, 5592, 6682, 7207, 2617, 355, 4611, 3064, 1319, 1118, 4946, 1789, 2814, 2617, 5969, 5124, 5772, 4276, 314, 5176, 6918, 497, 2065, 5974, 1801, 4029, 2078, 5883, 7757, 3933, 6887, 5533, 1285, 7617, 6027, 7487, 3558, 2200, 5745, 767, 1836, 3953, 5527, 6273, 1667, 2491, 879, 7054, 2855, 940, 5292, 609, 4584, 2468, 6413, 3825, 734, 892, 7862, 290, 4237, 3251, 4991, 2840, 4352, 6657, 2407, 5697, 122, 798, 948, 7651, 99, 7096, 3398, 433, 3193, 2862, 1090, 8109, 1384, 2410, 3068, 762, 938, 1662, 3362, 3385, 3602, 4732, 1227, 1047, 2450, 8165, 5535, 7977, 4216, 7350, 5254, 2870, 6617, 855, 6216, 1866, 2746, 5301, 7497, 4796, 1379, 3480, 1565, 6503, 3804, 7098, 685, 869, 5724, 4894, 4600, 7482, 4366, 4255, 6066, 95, 1298, 4064, 4839, 7888, 7459, 2032, 5210, 1265, 5803, 7747, 2895, 7016, 5878, 590, 2413, 7079, 2114, 4218, 3095, 1892, 4712, 1788, 5754, 2197, 8037, 5095, 1237, 2302, 4078, 7985, 6410, 3069, 5500, 5879, 8002, 6084, 6402, 3772, 4636, 1548, 7667, 5103, 1090, 5038, 5084, 1090, 5363, 8040, 5267, 3844, 6014, 6594, 2694, 7961, 6141, 98, 5042, 4141, 5649, 3767, 3968, 3587, 3605, 350, 4155, 1072, 59, 4791, 2635, 2330, 4577, 5126, 664, 3207, 5106, 5895, 1993, 5172, 396, 7549, 5100, 2841, 3402, 6513, 2688, 8089, 5251, 6921, 153, 3327, 2979, 7995, 153, 4693, 921, 5390, 7556, 2264, 3926, 290, 2780, 5545, 6147, 6082, 3105, 1942, 7269, 5508, 6060, 4709, 8143, 2518, 7550, 3889, 7323, 3362, 3474, 8147, 599, 3938, 2800, 4676, 1223, 4151, 767, 292, 5506, 5731, 3104, 7697, 6812, 6921, 4358, 4810, 2472, 3877, 1313, 4425, 4991, 2142, 88, 3599, 7718, 3233, 4571, 3629, 182, 5911, 2975, 3735, 7806, 6768, 7593, 2722, 7632, 3827, 3194, 1698, 4309, 8158, 7919, 4659, 5426, 7504, 3282, 1873, 6613, 5686, 4228, 7718, 2252, 4436, 1817, 4539, 5721, 3794, 2458, 3539, 4871, 2061, 2745, 5103, 5543, 3631, 2759, 4614, 3759, 7326, 3028, 6901, 1630, 7160, 5910, 1432, 3222, 4286, 5292, 6190, 3842, 6196, 5800, 6247, 6711, 5423, 3222, 4504, 3929, 557, 128, 7596, 4351, 2003, 4707, 3708, 1434, 8055, 6233, 3914, 4306, 7132, 5312, 59, 4833, 5637, 7751, 4050, 6231, 3697, 5966, 2693, 2967, 3903, 6807, 6010, 7148, 7625, 23, 3310, 3282, 3263, 4257, 5409, 4971, 1379, 1238, 921, 6706, 1867, 2904, 5944, 4740, 7396, 6394, 1565, 5490, 4730, 2525, 4161, 6882, 3640, 5217, 3157, 2652, 958, 4403, 5390, 1773, 3235, 3177, 3374, 2523, 1779, 3754, 664, 4447, 6483, 2224, 4278, 1205, 4570, 6011, 3774, 1750, 6229, 826, 2732, 894, 8109, 7890, 1460, 6636, 3111, 4430, 4590, 6756, 3115, 3749, 3465, 355, 6014, 4928, 7428, 4314, 7017, 7157, 4314, 6215, 6022, 4955, 4366, 4940, 6553, 8165, 5730, 4371, 4741, 3484, 6945, 2167, 2498, 4941, 5781, 2235, 4826, 6220, 3041, 5652, 6759, 4743, 7710, 4601, 3729, 1816, 4507, 5945, 6995, 6295, 1154, 6229, 2518, 1843, 6526, 7548, 688, 1391, 4361, 4854, 2017, 7927, 5891, 4422, 5389, 1611, 1093, 1475, 1921, 7628, 3474, 180, 1131, 3371, 4887, 4136, 2770, 674, 7614, 5438, 2019, 4059, 6361, 3598, 3698, 2160, 221, 6427, 5972, 8074, 4188, 7482, 480, 2431, 4629, 402, 1237, 2360, 2090, 7842, 5410, 6718, 7908, 6779, 6864, 6436, 4857, 6674, 691, 8138, 1005, 7340, 4595, 562, 2798, 2964, 2582, 3640, 3673, 7047, 3921, 3222, 3103, 1857, 254, 1377, 6202, 435, 2354, 5108, 7981, 4654, 6078, 2125, 6961, 4683, 992, 6879, 5839, 5994, 2960, 2451, 4815, 5103, 73, 4281, 2551, 1908, 4435, 978, 4957, 1544, 7370, 4403, 2109, 715, 4022, 5468, 7229, 1589, 4785, 6546, 5796, 6818, 7967, 3402, 1971, 4038, 3947, 1902, 1888, 4281, 2895, 4834, 6129, 2939, 5994, 5721, 1421, 436, 5790, 5004, 5649, 3963, 2214, 3989, 3238, 6697, 7508, 5855, 6804, 387, 4902, 7850, 7924, 5275, 7066, 2630, 7783, 3946, 4040, 411, 8113, 5651, 4925, 2283, 5613, 619, 955, 1810, 4071, 7887, 6361, 2105, 1253, 7941, 1065, 2640, 5246, 2071, 6982, 6271, 2579, 2941, 4474, 3501, 6197, 5509, 5390, 2688, 1610, 581, 5128, 3941, 7136, 3784, 7651, 1439, 3387, 1382, 5394, 1532, 5959, 6803, 1131, 7638, 7285, 4487, 7750, 5868, 2596, 7911, 218, 6670, 1216, 2808, 7, 4332, 3649, 2196, 7050, 1709, 8036, 5108, 6124, 6342, 2537, 7001, 3021, 4073, 5317, 3812, 5774]
# global_tokens = torch.tensor(data["global_tokens"]).unsqueeze(0).to(device)
# semantic_tokens = torch.tensor(data["semantic_tokens"]).unsqueeze(0).to(device)
global_tokens = torch.tensor(global_tokens).unsqueeze(0).to(device)
semantic_tokens = torch.tensor(semantic_tokens).unsqueeze(0).to(device)
wav_reconstructed = audio_tokenizer.detokenize(global_tokens, semantic_tokens)

import soundfile as sf
sf.write("from_spark_audio_tokens.wav", wav_reconstructed, audio_tokenizer.config['sample_rate'])