from sparktts.models.audio_tokenizer import BiCodecTokenizer

model_dir = '/home/yueyulin/models/Spark-TTS-0.5B/'
device = 'cpu'
audio_tokenizer = BiCodecTokenizer(model_dir, device)

data ={"language": "en", "global_tokens": [1079, 746, 909, 4060, 674, 1537, 2720, 453, 2505, 75, 1654, 3276, 980, 3620, 3313, 1758, 1215, 1146, 3757, 1230, 26, 519, 2289, 1120, 4026, 1996, 3278, 3213, 3506, 1169, 2665, 581], "semantic_tokens": [7844, 2120, 6859, 3515, 6134, 4958, 2777, 5560, 949, 7382, 5194, 1318, 3638, 6264, 6235, 2125, 3644, 6831, 5618, 3493, 796, 4543, 7350, 4268, 6121, 5186, 5592, 2007, 2452, 8118, 1118, 3737, 338, 1211, 7859, 4935, 6975, 132, 3200, 6061, 4516, 2386, 1385, 4319, 2903, 2177, 6316, 1845, 2590, 850, 6602, 3135, 3365, 1472, 937, 5004, 8059, 5386, 3615, 4744, 3961, 191, 3604, 7873, 7299, 1947, 1703, 3022, 5155, 4415, 152, 3262, 4258, 6651, 1994, 90, 4778, 5478, 4818, 264, 2670, 4895, 4284, 4350, 5670, 3816, 2265, 3267, 5970, 4111, 4902, 5754, 4948, 1250, 2026, 2599, 3415, 6832, 3859, 6794, 351, 4325, 4284, 244, 5575, 1078, 1512, 3618, 2028, 4, 6592, 4428, 4195, 7393, 3709, 5150, 384, 1723, 5985, 7847, 3118, 7406, 3658, 5553, 4656, 575, 528, 7832, 563, 2870, 4505, 1060, 5314, 1522, 6406, 6235, 1194, 4955, 6239, 2422, 929, 8054, 2614, 6645, 4186, 4249, 3319, 2873, 7497, 4324, 6474, 3438, 478, 1683, 6390, 4407, 4985, 6067, 887, 6685, 904, 7230, 1847, 5690, 541, 2681, 4275, 7196, 4217, 7408, 583, 749, 1416, 1881, 5877, 2570, 3578, 2723, 1223, 1400, 4044, 361, 7868, 4219, 926, 5919, 3740, 2311, 5269, 7270, 605, 7942, 1427, 4297, 5406, 6895, 3721, 2741, 5196, 5665, 2023, 6138, 1255, 2045, 4659, 4822, 2330, 7614, 1635, 6027, 4634, 347, 3140, 5772, 5677, 5194, 5656, 7239, 347, 2477, 7875, 1766, 5106, 6028, 1930, 5560, 7871, 1340, 7082, 3607, 5391, 7199, 1432, 5468, 6398, 1726, 7724, 5845, 627, 2719, 6141, 2995, 6791, 233, 6658, 7932, 200, 54, 1857, 6239, 6103, 2700, 4302, 6725, 1878, 6534, 6415, 7056, 6943, 4579, 3205, 870, 738, 6816, 580, 6388, 4674, 7151, 1509, 3503, 2159, 6648, 3362, 7233, 5390, 1983, 429, 4949, 5482, 3012, 1882, 892, 4781, 4529, 3201, 6946, 2274, 165, 5620, 5617, 4052, 2799, 1249, 1053, 1492, 3697, 4891, 6704, 7459, 3379, 504, 2476, 1891, 2665, 8161, 3077, 6457, 1717, 1801, 6298, 4740, 1820, 7437, 7092, 2030, 2697, 2244, 4659, 7670, 1516, 4944, 4536, 6961, 7860, 1375, 8118, 4644, 7403, 2702, 4779, 3826, 733, 5526, 7796, 3749, 687, 2179, 3723, 2321, 5960, 5683, 3937, 4033, 4182, 3790, 7751, 2672, 3151, 45, 2285, 656, 7282, 4603, 4006, 7792, 7145, 2162, 6738, 4344, 7471, 420, 3438, 3171, 7738, 3044, 7290, 1734, 3677, 7919, 7391, 6023, 2132, 1185, 6691, 794, 7917, 5681, 4021, 6798, 68, 7614, 6230, 6796, 5943, 4721, 2750, 1053, 267, 749, 4314, 1864, 4266, 4156, 2563, 7198, 3877, 7292, 6359, 7079, 1261, 6431, 8092, 2338, 1726, 6799, 6774, 3204, 7617, 5126, 7405, 6898, 6762, 7228, 8187, 1464, 4141, 3655, 6546, 8111, 1963, 6357, 3650, 7815, 5553, 7138, 713, 6044, 6358, 614, 1707, 5140, 683, 8118, 7410, 148, 6609, 6624, 4968, 4940, 1725, 757, 7473, 3611, 1430, 5749, 4778, 4511, 7203, 2036, 4961, 2896, 5763, 7958, 3977, 69, 4207, 6982, 5467, 2188, 2250, 6832, 1345, 1799, 3353, 871, 794, 6110, 7076, 6847, 2250, 2905, 5156, 4358, 6602, 7881, 5660, 1896, 7844, 4004, 528, 2783, 2497, 2338, 2564, 7304, 2262, 7001, 6854, 3662, 75, 1257, 251, 2807, 8188, 1679, 3222, 2259, 1347, 7292, 1190, 3888, 1902, 8139, 6223, 3457, 347, 5739, 4103, 1845, 4706, 1909, 3070, 1958, 5605, 2012, 4781, 6819, 280, 2883, 3607, 289, 7704, 5632, 7784, 8064, 4747, 3969, 3489, 7388, 3211, 1016, 4215, 2137, 1194, 3864, 3609, 3342, 278, 7183, 6029, 4581, 4832, 5802, 8015, 3020, 3350, 4119, 940, 6865, 4727, 4889, 5200, 1593, 6245, 2786, 5147, 1014, 5595, 693, 6222, 2811, 353, 5300, 5363, 1960, 6188, 777, 5123, 7425, 1387, 1572, 4356, 3534, 1573, 3291, 2956, 1736, 1634, 1497, 1664, 5376, 7616, 6162, 5316, 3153, 1773, 2482, 1888, 6062, 5329, 3373, 7078, 3490, 4278, 6645, 5278, 6417, 2606, 597, 8039, 4927, 54, 6018, 8190, 793, 3033, 7534, 4781, 1285, 551, 7966, 2878, 3944, 3994, 7146, 3041, 3983, 2880, 1789, 4379, 6415, 2072, 2192, 4946, 973, 6170, 1231, 2759, 7808, 2673, 333, 2990, 1106, 6401, 1437], "index": "mls_english_0000000336", "split": "test", "age": "Youth-Adult", "gender": "female", "emotion": "NEUTRAL", "pitch": 209.88, "pitch_std": 0.181, "speed": 4.4, "duration": 12.71, "speech_duration": 12.62, "syllable_num": 55, "text": "But put on all colours indifferently with which they are enlightned. These things being so, it can be no longer disputed, whether there be colours in the dark nor whether they be the qualities of the objects we see.", "syllables": "B-AH1-T P-UH1 T-AA1 N-AO1-L K-AH1 L-ER0 Z-IH0-N F-IH1 R-AH0-N T-L-IY0 W-IH1 DH-W-IH1-CH DH-EY1 AA1 R-EH0 N-L-AY1 T-AH0-N-D DH-IY1-Z TH-IH1-NG-Z B-IY1 IH0-NG S-OW1 IH1-T K-AE1-N B-IY1 N-OW1 L-AO1-NG G-ER0 D-IH0-S P-Y-UW1 T-AH0 D-W-EH1 DH-ER0 DH-EH1-R B-IY1 K-AH1 L-ER0 Z-IH0-N DH-AH0 D-AA1-R K-N-AO1 R-W-EH1 DH-ER0 DH-EY1 B-IY1 DH-AH0 K-W-AA1 L-AH0 T-IY0 Z-AH1-V DH-AH0 AA1-B JH-EH0-K-T S-W-IY1 S-IY1", "wav_path": "mls_english/mls_english_0000000336.flac"}
import torch
global_tokens = data["global_tokens"]
semantic_tokens = data["semantic_tokens"]
# global_tokens = torch.tensor(data["global_tokens"]).unsqueeze(0).to(device)
# semantic_tokens = torch.tensor(data["semantic_tokens"]).unsqueeze(0).to(device)
global_tokens = torch.tensor(global_tokens).unsqueeze(0).to(device)
semantic_tokens = torch.tensor(semantic_tokens).unsqueeze(0).to(device)
wav_reconstructed = audio_tokenizer.detokenize(global_tokens, semantic_tokens)

import soundfile as sf
sf.write("from_spark_audio_tokens_training.wav", wav_reconstructed, audio_tokenizer.config['sample_rate'])